<!DOCTYPE html>

<html>
<head>
  <title>ActiveResource.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="layout.css" />
  <style>
    /*--------------------- Layout and Typography ----------------------------*/
body { font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif; font-size: 15px; line-height: 22px; color: #252519; margin: 0; padding: 0;
}
a { color: #261a3b;
} a:visited { color: #261a3b; }
p { margin: 0 0 15px 0;
}
h1, h2, h3, h4, h5, h6 { margin: 40px 0 15px 0;
} h3, h4, h5, h6 { margin-top: 20px; }
#container { position: relative;
}
#background { position: fixed; top: 0; left: 575px; right: 0; bottom: 0; background: #f5f5ff; border-left: 1px solid #e5e5ee; z-index: -1;
}
#jump_to, #jump_page { background: white; -webkit-box-shadow: 0 0 25px #777; -moz-box-shadow: 0 0 25px #777; -webkit-border-bottom-left-radius: 5px; -moz-border-radius-bottomleft: 5px; font: 10px Arial; text-transform: uppercase; cursor: pointer; text-align: right;
}
#jump_to, #jump_wrapper { position: fixed; right: 0; top: 0; padding: 5px 10px;
} #jump_wrapper { padding: 0; display: none; } #jump_to:hover #jump_wrapper { display: block; } #jump_page { padding: 5px 0 3px; margin: 0 0 25px 25px; overflow:hidden; } #jump_page .source { display: block; padding: 5px 10px; text-decoration: none; border-top: 1px solid #eee; float:left; min-width:180px; text-align:left; text-transform:none; font-size:11px; } #jump_page .source:hover { background: #f5f5ff; } #jump_page .source:first-child { }
table td { border: 0; outline: 0;
} td.docs, th.docs { max-width: 450px; min-width: 450px; min-height: 5px; padding: 10px 25px 1px 50px; overflow-x: hidden; vertical-align: top; text-align: left; } .docs pre { margin: 15px 0 15px; padding-left: 15px; } .docs p tt, .docs p code { background: #f8f8ff; border: 1px solid #dedede; font-size: 12px; padding: 0 0.2em; } .pilwrap { position: relative; } .pilcrow { font: 12px Arial; text-decoration: none; color: #454545; position: absolute; top: 3px; left: -20px; padding: 1px 2px; opacity: 0; -webkit-transition: opacity 0.2s linear; } td.docs:hover .pilcrow { opacity: 1; } td.code, th.code { padding: 14px 15px 16px 25px; width: 100%; vertical-align: top; background: #f5f5ff; border-left: 1px solid #e5e5ee; } pre, tt, code { font-size: 12px; line-height: 18px; font-family: Monaco, Consolas, "Lucida Console", monospace; margin: 0; padding: 0; } /*---------------------- Syntax Highlighting -----------------------------*/
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
body .hll { background-color: #ffffcc }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #954121 } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #808080 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0040D0 } /* Generic.Traceback */
body .kc { color: #954121 } /* Keyword.Constant */
body .kd { color: #954121; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #954121; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #954121 } /* Keyword.Pseudo */
body .kr { color: #954121; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #219161 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #954121 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #954121; font-weight: bold } /* Name.Tag */
body .nv { color: #19469D } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #219161 } /* Literal.String.Backtick */
body .sc { color: #219161 } /* Literal.String.Char */
body .sd { color: #219161; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #219161 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #219161 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #954121 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #219161 } /* Literal.String.Single */
body .ss { color: #19469D } /* Literal.String.Symbol */
body .bp { color: #954121 } /* Name.Builtin.Pseudo */
body .vc { color: #19469D } /* Name.Variable.Class */
body .vg { color: #19469D } /* Name.Variable.Global */
body .vi { color: #19469D } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */ /********** PHP Comment Additions ********/
td.docs .docparam {color:#DB251A;font-weight:bold;}
  </style>
</head>
<body>
  <div id="container">
    <div id="background"></div>
          <div id="jump_to">
        Jump To &hellip;
        <div id="jump_wrapper">
          <div id="jump_page">
                                          <a class="source" href="./ActiveResource.html">
                              ActiveResource.php              </a>
                                          <a class="source" href="./Autoloader.html">
                              Autoloader.php              </a>
                                          <a class="source" href="./Cache.html">
                              Cache.php              </a>
                                          <a class="source" href="./Controller.html">
                              Controller.php              </a>
                                          <a class="source" href="./Database.html">
                              Database.php              </a>
                                          <a class="source" href="./Debugger.html">
                              Debugger.php              </a>
                                          <a class="source" href="./Form.html">
                              Form.php              </a>
                                          <a class="source" href="./Functions.html">
                              Functions.php              </a>
                                          <a class="source" href="./I18n.html">
                              I18n.php              </a>
                                          <a class="source" href="./MemcacheExt.html">
                              MemcacheExt.php              </a>
                                          <a class="source" href="./Model.html">
                              Model.php              </a>
                                          <a class="source" href="./MongoManager.html">
                              MongoManager.php              </a>
                                          <a class="source" href="./MongoModel.html">
                              MongoModel.php              </a>
                                          <a class="source" href="./Page.html">
                              Page.php              </a>
                                          <a class="source" href="./Product.html">
                              Product.php              </a>
                                          <a class="source" href="./Restful.html">
                              Restful.php              </a>
                                          <a class="source" href="./Template.html">
                              Template.php              </a>
                      </div>
        </div>
      </div>
        <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs">
            <h1>
              ActiveResource.php            </h1>
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
                  <tr id="section-0">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-0">&#182;</a>
              </div>
              <p>Basic implementation of the Ruby on Rails ActiveResource REST client.
 Intended to work with RoR-based REST servers, which all share similar
 API patterns.</p>

<p>Usage:</p>

<pre><code> &lt;?php

 require_once ('ActiveResource.php');

 class Song extends ActiveResource {
     var $site = 'http:localhost:3000/';
     var $element_name = 'songs';
 }

  create new item
 $song = new Song (array ('artist' =&gt; 'Joe Cocker', 'title' =&gt; 'A Little Help From My Friends'));
 $song-&gt;save ();

  fetch and update an item
 $song-&gt;find (44)-&gt;set ('title', 'The River')-&gt;save ();

  line by line
 $song-&gt;find (44);
 $song-&gt;title = 'The River';
 $song-&gt;save ();

  get all songs
 $songs = $song-&gt;find ('all');

  delete a song
 $song-&gt;find (44);
 $song-&gt;destroy ();

  custom method
 $songs = $song-&gt;get ('by_year', array ('year' =&gt; 1999));

 ?&gt;
</code></pre>

<p><em class='docparam'>@author</em> John Luxford <a href="m&#97;&#105;&#108;&#116;&#111;&#58;&#108;&#117;&#120;&#64;&#x63;&#x6f;&#x6d;&#x70;&#x61;&#x6e;&#x79;&#x6d;&#x61;c&#104;&#105;&#110;&#101;&#46;&#99;&#111;&#109;">&#108;&#117;&#120;&#64;&#x63;&#x6f;&#x6d;&#x70;&#x61;&#x6e;&#x79;&#x6d;&#x61;c&#104;&#105;&#110;&#101;&#46;&#99;&#111;&#109;</a>
<em class='docparam'>@version</em> 0.14 beta
<em class='docparam'>@license</em> http:opensource.org/licenses/lgpl-2.1.php</p>
            </td>
            <td class="code">
              <div class="highlight"><pre><span class="k">class</span> <span class="nc">ActiveResource</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-1">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>The REST site address, e.g., <code>http:user:pass@domain:port/</code></p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$site</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-2">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Add any extra params to the end of the url eg: API key</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$extra_params</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-3">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>HTTP Basic Authentication user</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$user</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-4">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>HTTP Basic Authentication password</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> 
 <span class="k">public</span> <span class="nv">$password</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-5">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The remote collection, e.g., person or thing</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$element_name</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-6">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Pleural form of the element name, e.g., people or things</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$element_name_plural</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-7">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The data of the current object, accessed via the anonymous get/set methods.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">private</span> <span class="nv">$_data</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span></pre></div>            </td>
          </tr>
                  <tr id="section-8">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>An error message if an error occurred.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$error</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-9">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>The error number if an error occurred.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$errno</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-10">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>The request that was sent to the server.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$request_body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-11">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>The complete URL that the request was sent to.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$request_uri</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-12">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>The request method sent to the server.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$request_method</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-13">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>The response code returned from the server.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$response_code</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-14">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>The raw response headers sent from the server.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$response_headers</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-15">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>The response body sent from the server.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$response_body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-16">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The format requests should use to send data (url or xml).</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$request_format</span> <span class="o">=</span> <span class="s1">&#39;url&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-17">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Corrections to improper pleuralizations.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="nv">$pleural_corrections</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
  <span class="s1">&#39;persons&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;people&#39;</span><span class="p">,</span>
  <span class="s1">&#39;peoples&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;people&#39;</span><span class="p">,</span>
  <span class="s1">&#39;mans&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;men&#39;</span><span class="p">,</span>
  <span class="s1">&#39;mens&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;men&#39;</span><span class="p">,</span>
  <span class="s1">&#39;womans&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;women&#39;</span><span class="p">,</span>
  <span class="s1">&#39;womens&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;women&#39;</span><span class="p">,</span>
  <span class="s1">&#39;childs&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span>
  <span class="s1">&#39;childrens&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span>
  <span class="s1">&#39;sheeps&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sheep&#39;</span><span class="p">,</span>
  <span class="s1">&#39;octopuses&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;octopi&#39;</span><span class="p">,</span>
  <span class="s1">&#39;quizs&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;quizzes&#39;</span><span class="p">,</span>
  <span class="s1">&#39;axises&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;axes&#39;</span><span class="p">,</span>
  <span class="s1">&#39;buffalos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;buffaloes&#39;</span><span class="p">,</span>
  <span class="s1">&#39;tomatos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;tomatoes&#39;</span><span class="p">,</span>
  <span class="s1">&#39;potatos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;potatoes&#39;</span><span class="p">,</span>
  <span class="s1">&#39;oxes&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;oxen&#39;</span><span class="p">,</span>
  <span class="s1">&#39;mouses&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mice&#39;</span><span class="p">,</span>
  <span class="s1">&#39;matrixes&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;matrices&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vertexes&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;vertices&#39;</span><span class="p">,</span>
  <span class="s1">&#39;indexes&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;indices&#39;</span><span class="p">,</span>
 <span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-18">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Constructor method.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span> <span class="p">())</span> <span class="p">{</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-19">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Allow class-defined element name or use class name if not defined</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span> <span class="o">:</span> <span class="nb">strtolower</span> <span class="p">(</span><span class="nb">get_class</span> <span class="p">(</span><span class="nv">$this</span><span class="p">));</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pluralize</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-20">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Detect for namespaces, and take just the class name</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nb">stripos</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="p">))</span>
  <span class="p">{</span>
   <span class="nv">$classItems</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;\\&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span><span class="p">);</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span> <span class="o">=</span> <span class="nb">end</span><span class="p">(</span><span class="nv">$classItems</span><span class="p">);</span>
  <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-21">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If configuration file (<code>config.ini.php</code>) exists use it (overwrite class properties/attribute values).</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$config_file_path</span> <span class="o">=</span> <span class="nb">dirname</span> <span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="s1">&#39;config.ini.php&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span> <span class="p">(</span><span class="nv">$config_file_path</span><span class="p">))</span> <span class="p">{</span>
   <span class="nv">$properties</span> <span class="o">=</span> <span class="nb">parse_ini_file</span> <span class="p">(</span><span class="nv">$config_file_path</span><span class="p">);</span>
   <span class="k">foreach</span> <span class="p">(</span><span class="nv">$properties</span> <span class="k">as</span> <span class="nv">$property</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">)</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$property</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
  <span class="p">}</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-22">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Pluralize the element name.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">pluralize</span> <span class="p">(</span><span class="nv">$word</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$word</span> <span class="o">.=</span> <span class="s1">&#39;s&#39;</span><span class="p">;</span>
  <span class="nv">$word</span> <span class="o">=</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/(x|ch|sh|ss])s$/&#39;</span><span class="p">,</span> <span class="s1">&#39;\1es&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
  <span class="nv">$word</span> <span class="o">=</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/ss$/&#39;</span><span class="p">,</span> <span class="s1">&#39;ses&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
  <span class="nv">$word</span> <span class="o">=</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/([ti])ums$/&#39;</span><span class="p">,</span> <span class="s1">&#39;\1a&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
  <span class="nv">$word</span> <span class="o">=</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/sises$/&#39;</span><span class="p">,</span> <span class="s1">&#39;ses&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
  <span class="nv">$word</span> <span class="o">=</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/([^aeiouy]|qu)ys$/&#39;</span><span class="p">,</span> <span class="s1">&#39;\1ies&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
  <span class="nv">$word</span> <span class="o">=</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/(?:([^f])fe|([lr])f)s$/&#39;</span><span class="p">,</span> <span class="s1">&#39;\1\2ves&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
  <span class="nv">$word</span> <span class="o">=</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/ieses$/&#39;</span><span class="p">,</span> <span class="s1">&#39;ies&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pleural_corrections</span><span class="p">[</span><span class="nv">$word</span><span class="p">]))</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pleural_corrections</span><span class="p">[</span><span class="nv">$word</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$word</span><span class="p">;</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-23">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>For backwards-compatibility.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">pleuralize</span> <span class="p">(</span><span class="nv">$word</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pluralize</span> <span class="p">(</span><span class="nv">$word</span><span class="p">);</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-24">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Saves a new record or updates an existing one via:</p>

<pre><code> POST /collection.xml
 PUT  /collection/id.xml
</code></pre>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-25">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>update</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-26">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Create</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-27">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Deletes a record via:</p>

<pre><code> DELETE /collection/id.xml
</code></pre>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">);</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-28">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Finds a record or records via:</p>

<pre><code> GET /collection/id.xml
 GET /collection.xml
</code></pre>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span> <span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span> <span class="p">())</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$id</span> <span class="o">===</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nb">count</span> <span class="p">(</span><span class="nv">$options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$url</span> <span class="o">.=</span> <span class="s1">&#39;?&#39;</span> <span class="o">.</span> <span class="nb">http_build_query</span> <span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$id</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-29">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Gets a specified custom method on the current object via:</p>

<pre><code> GET /collection/id/method.xml
 GET /collection/id/method.xml?attr=value
</code></pre>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span> <span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span> <span class="p">())</span> <span class="p">{</span>
  <span class="nv">$req</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="p">{</span> 
          <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$method</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">count</span> <span class="p">(</span><span class="nv">$options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;?&#39;</span> <span class="o">.</span> <span class="nb">http_build_query</span> <span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-30">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Posts to a specified custom method on the current object via:</p>

<pre><code> POST /collection/id/method.xml
</code></pre>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">post</span> <span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span> <span class="p">())</span> <span class="p">{</span>
  <span class="nv">$req</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="p">{</span>
          <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$method</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-31">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Puts to a specified custom method on the current object via:</p>

<pre><code> PUT /collection/id/method.xml
</code></pre>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">put</span> <span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span> <span class="p">())</span> <span class="p">{</span>
  <span class="nv">$req</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">site</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="p">{</span> 
          <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$method</span> <span class="o">.</span> <span class="s1">&#39;.xml&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">count</span> <span class="p">(</span><span class="nv">$options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$req</span> <span class="o">.=</span> <span class="s1">&#39;?&#39;</span> <span class="o">.</span> <span class="nb">http_build_query</span> <span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_send_and_receive</span> <span class="p">(</span><span class="nv">$req</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">);</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-32">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Simple recursive function to build an XML response.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">_build_xml</span> <span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_object</span> <span class="p">(</span><span class="nv">$v</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">strtolower</span> <span class="p">(</span><span class="nb">get_class</span> <span class="p">(</span><span class="nv">$v</span><span class="p">))</span> <span class="o">===</span> <span class="s1">&#39;simplexmlelement&#39;</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nb">preg_replace</span> <span class="p">(</span><span class="s1">&#39;/&lt;\?xml(.*?)\?&gt;\n*/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$v</span><span class="o">-&gt;</span><span class="na">asXML</span> <span class="p">());</span>
  <span class="p">}</span>
  <span class="nv">$res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nv">$attrs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">is_numeric</span> <span class="p">(</span><span class="nv">$k</span><span class="p">))</span> <span class="p">{</span>
   <span class="nv">$res</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="s1">&#39;{{attributes}}&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span> <span class="p">(</span><span class="nv">$v</span><span class="p">))</span> <span class="p">{</span>
   <span class="k">foreach</span> <span class="p">(</span><span class="nv">$v</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-33">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>handle attributes of repeating tags</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nb">is_numeric</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">is_array</span> <span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">foreach</span> <span class="p">(</span><span class="nv">$value</span> <span class="k">as</span> <span class="nv">$sub_key</span> <span class="o">=&gt;</span> <span class="nv">$sub_value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span> <span class="p">(</span><span class="nv">$sub_key</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
       <span class="nv">$attrs</span> <span class="o">.=</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nb">substr</span> <span class="p">(</span><span class="nv">$sub_key</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_xml_entities</span> <span class="p">(</span><span class="nv">$sub_value</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
       <span class="nb">unset</span> <span class="p">(</span><span class="nv">$value</span><span class="p">[</span><span class="nv">$sub_key</span><span class="p">]);</span>
       <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
     <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span> <span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$attrs</span> <span class="o">.=</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nb">substr</span> <span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_xml_entities</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
     <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$res</span> <span class="o">.=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_build_xml</span> <span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$keys</span> <span class="o">=</span> <span class="nb">array_keys</span> <span class="p">(</span><span class="nv">$v</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_numeric</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$key</span> <span class="o">!==</span> <span class="nb">array_pop</span> <span class="p">(</span><span class="nv">$keys</span><span class="p">))</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-34">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>reset attributes on repeating tags</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>     <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span> <span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
      <span class="nv">$res</span> <span class="o">=</span> <span class="nb">str_replace</span> <span class="p">(</span><span class="s1">&#39;&lt;&#39;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="s1">&#39;{{attributes}}&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="nv">$attrs</span> <span class="o">.</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nv">$res</span><span class="p">);</span>
      <span class="nv">$attrs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="nv">$res</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/&#39;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="s2">&quot;&gt;</span><span class="se">\n</span><span class="s2">&lt;&quot;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="s1">&#39;{{attributes}}&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
   <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
   <span class="nv">$res</span> <span class="o">.=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_xml_entities</span> <span class="p">(</span><span class="nv">$v</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">is_numeric</span> <span class="p">(</span><span class="nv">$k</span><span class="p">))</span> <span class="p">{</span>
   <span class="nv">$res</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/&#39;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="s2">&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nv">$res</span> <span class="o">=</span> <span class="nb">str_replace</span> <span class="p">(</span><span class="s1">&#39;&lt;&#39;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="s1">&#39;{{attributes}}&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">.</span> <span class="nv">$k</span> <span class="o">.</span> <span class="nv">$attrs</span> <span class="o">.</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nv">$res</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$res</span><span class="p">;</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-35">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Returns the unicode value of the string</p>

<p><em class='docparam'>@param</em> string $c The source string
<em class='docparam'>@param</em> integer $i The index to get the char from (passed by reference for use in a loop)
<em class='docparam'>@return</em> integer The value of the char at $c[$i]
<em class='docparam'>@author</em> kerry at shetline dot com
<em class='docparam'>@author</em> Dom Hastings - modified to suit my needs
<em class='docparam'>@see</em> http:www.php.net/manual/en/function.ord.php#78032</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">private</span> <span class="k">function</span> <span class="nf">_unicode_ord</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$c</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$i</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-36">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>get the character length</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$l</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-37">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>copy the offset</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$index</span> <span class="o">=</span> <span class="nv">$i</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-38">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>check it's a valid offset</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">&gt;=</span> <span class="nv">$l</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-39">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>check the value</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$o</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="nv">$index</span><span class="p">]);</span></pre></div>            </td>
          </tr>
                  <tr id="section-40">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>if it's ascii</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">0</span><span class="nx">x7F</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nv">$o</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-41">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>not sure what it is...</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&lt;</span> <span class="m">0</span><span class="nx">xC2</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">false</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-42">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>if it's a two-byte character  </p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">0</span><span class="nx">xDF</span> <span class="o">&amp;&amp;</span> <span class="nv">$index</span> <span class="o">&lt;</span> <span class="nv">$l</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$i</span> <span class="o">+=</span> <span class="m">1</span><span class="p">;</span>
   <span class="k">return</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x1F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="m">6</span> <span class="o">|</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="nv">$index</span> <span class="o">+</span> <span class="m">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x3F</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-43">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>three-byte</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">0</span><span class="nx">xEF</span> <span class="o">&amp;&amp;</span> <span class="nv">$index</span> <span class="o">&lt;</span> <span class="nv">$l</span> <span class="o">-</span> <span class="m">2</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$i</span> <span class="o">+=</span> <span class="m">2</span><span class="p">;</span>
   <span class="k">return</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x0F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="m">12</span> <span class="o">|</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="nv">$index</span> <span class="o">+</span> <span class="m">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x3F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="m">6</span> <span class="o">|</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="nv">$index</span> <span class="o">+</span> <span class="m">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x3F</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-44">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>four-byte</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">0</span><span class="nx">xF4</span> <span class="o">&amp;&amp;</span> <span class="nv">$index</span> <span class="o">&lt;</span> <span class="nv">$l</span> <span class="o">-</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$i</span> <span class="o">+=</span> <span class="m">3</span><span class="p">;</span>
   <span class="k">return</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x0F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="m">18</span> <span class="o">|</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="nv">$index</span> <span class="o">+</span> <span class="m">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x3F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="m">12</span> <span class="o">|</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="nv">$index</span> <span class="o">+</span> <span class="m">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x3F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="m">6</span> <span class="o">|</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="nv">$index</span> <span class="o">+</span> <span class="m">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="m">0</span><span class="nx">x3F</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-45">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>not sure what it is...</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-46">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Makes the specified string XML-safe</p>

<p><em class='docparam'>@param</em> string $s
<em class='docparam'>@param</em> boolean $hex Whether or not to make hexadecimal entities (as opposed to decimal)
<em class='docparam'>@return</em> string The XML-safe result
<em class='docparam'>@author</em> Dom Hastings
<em class='docparam'>@see</em> http:www.w3.org/TR/REC-xml/#sec-predefined-ent</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">_xml_entities</span> <span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="nv">$hex</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-47">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>if the string is empty</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$s</span><span class="p">))</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-48">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>just return it</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="k">return</span> <span class="nv">$s</span><span class="p">;</span>
  <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-49">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>create the return string</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$r</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-50">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>get the length</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$l</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$s</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-51">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>iterate the string</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$l</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-52">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>get the value of the character</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="nv">$o</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_unicode_ord</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-53">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>valid cahracters</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="nv">$v</span> <span class="o">=</span> <span class="p">(</span></pre></div>            </td>
          </tr>
                  <tr id="section-54">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>\t \n <vertical tab> <form feed> \r</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">9</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">13</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-55">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p><space> !</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">32</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">33</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-56">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p># $ %</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">35</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">37</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-57">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>( ) + , - . /</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">40</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">47</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-58">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>numbers</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">48</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">57</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-59">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>: ;</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">58</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">59</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-60">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>= ?</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">61</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">63</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-61">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p><em class='docparam'>@</em></p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">64</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-62">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>uppercase</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">65</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">90</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-63">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>[ \ ] ^ _ `</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">91</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">96</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-64">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>lowercase</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">97</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">122</span><span class="p">)</span> <span class="o">||</span></pre></div>            </td>
          </tr>
                  <tr id="section-65">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>{ | } ~</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;=</span> <span class="m">123</span> <span class="o">&amp;&amp;</span> <span class="nv">$o</span> <span class="o">&lt;=</span> <span class="m">126</span><span class="p">)</span>
   <span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-66">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>if it's valid, just keep it</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="k">if</span> <span class="p">(</span><span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$r</span> <span class="o">.=</span> <span class="nv">$s</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span></pre></div>            </td>
          </tr>
                  <tr id="section-67">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>&amp;</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">38</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$r</span> <span class="o">.=</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-68">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>&lt;</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">60</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$r</span> <span class="o">.=</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-69">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>></p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">62</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$r</span> <span class="o">.=</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-70">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>'</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">39</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$r</span> <span class="o">.=</span> <span class="s1">&#39;&amp;apos;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-71">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>"</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">===</span> <span class="m">34</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$r</span> <span class="o">.=</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-72">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>unknown, add it as a reference</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$hex</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$r</span> <span class="o">.=</span> <span class="s1">&#39;&amp;#x&#39;</span><span class="o">.</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nb">dechex</span><span class="p">(</span><span class="nv">$o</span><span class="p">))</span><span class="o">.</span><span class="s1">&#39;;&#39;</span><span class="p">;</span>
     
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="nv">$r</span> <span class="o">.=</span> <span class="s1">&#39;&amp;#&#39;</span><span class="o">.</span><span class="nv">$o</span><span class="o">.</span><span class="s1">&#39;;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
   <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nv">$r</span><span class="p">;</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-73">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Build the request, call <code>_fetch()</code> and parse the results.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">private</span> <span class="k">function</span> <span class="nf">_send_and_receive</span> <span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$method</span><span class="p">,</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span> <span class="p">())</span> <span class="p">{</span>
  <span class="nv">$params</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nv">$el</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name</span><span class="p">;</span></pre></div>            </td>
          </tr>
                  <tr id="section-74">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Singular this time</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request_format</span> <span class="o">===</span> <span class="s1">&#39;url&#39;</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$k</span> <span class="o">!==</span> <span class="s1">&#39;id&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$k</span> <span class="o">!==</span> <span class="s1">&#39;created-at&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$k</span> <span class="o">!==</span> <span class="s1">&#39;updated-at&#39;</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$params</span> <span class="o">.=</span> <span class="s1">&#39;&amp;&#39;</span> <span class="o">.</span> <span class="nv">$el</span> <span class="o">.</span> <span class="s1">&#39;[&#39;</span> <span class="o">.</span> <span class="nb">str_replace</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="nv">$k</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;]=&#39;</span> <span class="o">.</span> <span class="nb">rawurlencode</span> <span class="p">(</span><span class="nv">$v</span><span class="p">);</span>
    <span class="p">}</span>
   <span class="p">}</span>
   <span class="nv">$params</span> <span class="o">=</span> <span class="nb">substr</span> <span class="p">(</span><span class="nv">$params</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request_format</span> <span class="o">===</span> <span class="s1">&#39;xml&#39;</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$params</span> <span class="o">=</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;&#39;</span> <span class="o">.</span> <span class="nv">$el</span> <span class="o">.</span> <span class="s2">&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
   <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$k</span> <span class="o">!==</span> <span class="s1">&#39;id&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$k</span> <span class="o">!==</span> <span class="s1">&#39;created-at&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$k</span> <span class="o">!==</span> <span class="s1">&#39;updated-at&#39;</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$params</span> <span class="o">.=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_build_xml</span> <span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$v</span><span class="p">);</span>
    <span class="p">}</span>
   <span class="p">}</span>
   <span class="nv">$params</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/&#39;</span> <span class="o">.</span> <span class="nv">$el</span> <span class="o">.</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">extra_params</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span>
  <span class="p">{</span>
   <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$url</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">extra_params</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request_body</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">;</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request_uri</span> <span class="o">=</span> <span class="nv">$url</span><span class="p">;</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request_method</span> <span class="o">=</span> <span class="nv">$method</span><span class="p">;</span>

  <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_fetch</span> <span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$method</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span>
  <span class="p">{</span>
   <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
  <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-75">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Keep splitting off any top headers until we get to the (XML) body:</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">while</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$res</span><span class="p">,</span> <span class="s2">&quot;HTTP/&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">list</span> <span class="p">(</span><span class="nv">$headers</span><span class="p">,</span> <span class="nv">$res</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$res</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response_headers</span> <span class="o">=</span> <span class="nv">$headers</span><span class="p">;</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response_body</span> <span class="o">=</span> <span class="nv">$res</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span> <span class="p">(</span><span class="s1">&#39;/HTTP\/[0-9]\.[0-9] ([0-9]+)/&#39;</span><span class="p">,</span> <span class="nv">$headers</span><span class="p">,</span> <span class="nv">$regs</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response_code</span> <span class="o">=</span> <span class="nv">$regs</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response_code</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$res</span> <span class="o">===</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="s1">&#39;Empty reply&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
   <span class="p">}</span>
  <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-76">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Parse XML response</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$xml</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleXMLElement</span> <span class="p">(</span><span class="nv">$res</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-77">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Normalize xml element name in case rails ressource contains an underscore</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nb">str_replace</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="na">getName</span> <span class="p">())</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">element_name_plural</span><span class="p">)</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-78">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Multiple</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="nv">$res</span> <span class="o">=</span> <span class="k">array</span> <span class="p">();</span>
   <span class="nv">$cls</span> <span class="o">=</span> <span class="nb">get_class</span> <span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
   <span class="k">foreach</span> <span class="p">(</span><span class="nv">$xml</span><span class="o">-&gt;</span><span class="na">children</span> <span class="p">()</span> <span class="k">as</span> <span class="nv">$child</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$cls</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">((</span><span class="k">array</span><span class="p">)</span> <span class="nv">$child</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
     <span class="nv">$k</span> <span class="o">=</span> <span class="nb">str_replace</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="nv">$k</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;nil&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;nil&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$k</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="p">}</span>
    <span class="nv">$res</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$obj</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nv">$res</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$xml</span><span class="o">-&gt;</span><span class="na">getName</span> <span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;errors&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>            </td>
          </tr>
                  <tr id="section-79">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Parse error message</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">;</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errno</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response_code</span><span class="p">;</span>
   <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">foreach</span> <span class="p">((</span><span class="k">array</span><span class="p">)</span> <span class="nv">$xml</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$k</span> <span class="o">=</span> <span class="nb">str_replace</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="nv">$k</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;nil&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;nil&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">continue</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$k</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
   <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-80">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Fetch the specified request via cURL.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">private</span> <span class="k">function</span> <span class="nf">_fetch</span> <span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$method</span><span class="p">,</span> <span class="nv">$params</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">extension_loaded</span> <span class="p">(</span><span class="s1">&#39;curl&#39;</span><span class="p">))</span> <span class="p">{</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="s1">&#39;cURL extension not loaded.&#39;</span><span class="p">;</span>
   <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span> <span class="p">();</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_MAXREDIRS</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_VERBOSE</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CONNECTTIMEOUT</span><span class="p">,</span> <span class="m">10</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYHOST</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-81">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>HTTP Basic Authentication</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">)</span> <span class="p">{</span>
   <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">.</span> <span class="s2">&quot;:&quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">);</span> 
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request_format</span> <span class="o">===</span> <span class="s1">&#39;xml&#39;</span><span class="p">)</span> <span class="p">{</span>
   <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span> <span class="p">(</span><span class="s2">&quot;Expect:&quot;</span><span class="p">,</span> <span class="s2">&quot;Content-Type: text/xml&quot;</span><span class="p">,</span> <span class="s2">&quot;Length: &quot;</span> <span class="o">.</span> <span class="nb">strlen</span> <span class="p">(</span><span class="nv">$params</span><span class="p">)));</span>
  <span class="p">}</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nv">$method</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">case</span> <span class="s1">&#39;POST&#39;</span><span class="o">:</span>
    <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
    <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
   <span class="k">case</span> <span class="s1">&#39;DELETE&#39;</span><span class="o">:</span>
    <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
   <span class="k">case</span> <span class="s1">&#39;PUT&#39;</span><span class="o">:</span>
    <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">);</span>
    <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
   <span class="k">case</span> <span class="s1">&#39;GET&#39;</span><span class="o">:</span>
   <span class="k">default</span><span class="o">:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nv">$res</span> <span class="o">=</span> <span class="nb">curl_exec</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">);</span></pre></div>            </td>
          </tr>
                  <tr id="section-82">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Check HTTP status code for denied access</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nv">$http_code</span> <span class="o">=</span> <span class="nb">curl_getinfo</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLINFO_HTTP_CODE</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$http_code</span> <span class="o">===</span> <span class="m">401</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errno</span> <span class="o">=</span> <span class="nv">$http_code</span><span class="p">;</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="s2">&quot;HTTP Basic: Access denied.&quot;</span><span class="p">;</span>
   <span class="nb">curl_close</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
   <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$res</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errno</span> <span class="o">=</span> <span class="nb">curl_errno</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="nb">curl_error</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
   <span class="nb">curl_close</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
   <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nb">curl_close</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$res</span><span class="p">;</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-83">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Getter for internal object data.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">__get</span> <span class="p">(</span><span class="nv">$k</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$k</span><span class="p">]))</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$k</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$k</span><span class="p">};</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-84">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Setter for internal object data.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">__set</span> <span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$k</span><span class="p">]))</span> <span class="p">{</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$k</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
   <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$k</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
 <span class="p">}</span></pre></div>            </td>
          </tr>
                  <tr id="section-85">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Quick setter for chaining methods.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre> <span class="k">public</span> <span class="k">function</span> <span class="nf">set</span> <span class="p">(</span><span class="nv">$k</span><span class="p">,</span> <span class="nv">$v</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$v</span> <span class="o">&amp;&amp;</span> <span class="nb">is_array</span> <span class="p">(</span><span class="nv">$k</span><span class="p">))</span> <span class="p">{</span>
   <span class="k">foreach</span> <span class="p">(</span><span class="nv">$k</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
   <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
   <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_data</span><span class="p">[</span><span class="nv">$k</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
 <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div></pre></div>            </td>
          </tr>
              </tbody>
    </table>
  </div>
</body>
</html>
